<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/black.css">
	<link rel="stylesheet" href="css/theme/main.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<h3>Cross-build Node modules</h3>
				<p class="ta-left">Use Docker to build environment for cross-compiling node 
					modules for the LinkIt 7688.
				</p>
			</section>
			<section>
				<section>
					<br>
					<br>
					<div class="stretch">
						<img src="assets/linkit7688_duo.png" alt="LinkIt 7688 Duo microcontroller">
					</div>
				</section>
				<section>
					<h4>Hardware Specs</h4>
					<table>
						<thead>
							<tbody>
								<tr>
									<td>CPU</td>
									<td>MIPS 24KEc 580MHz</td>
								</tr>
								<tr>
									<td>RAM</td>
									<td>128MB</td>
								</tr>
								<tr>
									<td>Flash</td>
									<td>32MB</td>
								</tr>
								<tr>
									<td>WiFi</td>
									<td>b/g/n 2.4GHz</td>
								</tr>
								<tr>
									<td>Ethernet</td>
									<td>10/100Mbps</td>
								</tr>
								<tr>
									<td>SD</td>
									<td>SD-XC</td>
								</tr>
								<tr>
									<td>USB</td>
									<td>USB 2.0 (Micro-B)</td>
								</tr>
								<tr>
									<td>MCU</td>
									<td>ATmega32U4 8MHz</td>
								</tr>
							</tbody>
					</table>
				</section>
				<section>
					<div class="high_level_open_wrt">
						<label>Open WRT</label>
						<div class="high_level_app_logic">
							<span>App Logic</span>
						</div>
						<div class="high_level_node_js">
							<span>Node.js</span>
						</div>
						<div class="high_level_firmata_open_wrt">
							<span>Firmata</span>
						</div>
					</div>
					<div class="high_level_arduino">
						<label>Arduino</label>
						<div class="high_level_firmata_arduino">
							<span>Firmata</span>
						</div>
						<div class="high_level_sensors">
							<span>Sensors</span>
						</div>
					</div>
				</section>
				<section>
					<h4>Problems installing Node modules</h4>
					<ul>
						<li>Slow processor</li>
						<li>Limited RAM (128 MB)</li>
						<li>Limited flash storage (32 MB)</li>
						<li>Connection timeout issues</li>
					</ul>
				</section>
				<section>
					<pre><code>npm install express</code></pre>
					<!-- TODO: add video of npm install express failing -->
					<div class="stretch">
						<video src="assets/install_express_fail.mp4"></video>
					</div>
				</section>
				<section>
					<h4>MediaTek's Solution</h4>
					<p class="ta-left">Setup the following enviornment:</p>
					<ul>
						<li>Ubuntu v14.04</li>
						<li>Node v0.12.7, NPM v2.11.3</li>
						<li>subversion, build-essential, gcc-multilib, g++-multilib</li>
						<li>mt7688-cross repo</li>
					</ul>
				</section>
				<section>
					<h5>MediaTek's Solution (cont.)</h5>
					<p class="ta-left">Once the environment is created and the cross-build repo
						has been cloned, we must run a script to build the cross-build environment.
					</p>
					<pre><code>./create_env.sh</code></pre>
					<p class="ta-left">This process should take approximately 20 minutes.</p>
				</section>
				<section>
					<h3>But what if I don't have ...</h3>
					<ul>
						<li>Ubuntu</li>
						<br>
						<li>VM CLient:</li>
						<ul>
							<li>Parallels</li>
							<li>VirtualBox</li>
							<li>VMware</li>
						</ul>
					</ul>
				</section>

			</section>
			<section>
				<section>
					<div class="stretch">
						<img src="assets/docker_logo.png" alt="Docker logo">
					</div>
				</section>
				<section>
					<h4>What is it?</h4>
					<p class="ta-left">Docker automates setting up and configuring development
						environments.
					</p>
					<ul>
						<li>Easy to get going</li>
						<li>Light overhead compared to full VM</li>
						<li>Isolated</li>
						<li>Eliminates <i>"works on my box"</i></li>
					</ul>
				</section>
				<section>
					<h4>Containers</h4>
					<p class="ta-left">A container is an executable package that contains all the necessary
						software to run.
					</p>
					<ul>
						<li>efficient</li>
						<li>light-weight</li>
						<li>self-contained</li>
					</ul>
				</section>
				<section>
					<h4>Images</h4>
					<p class="ta-left">Docker images are the basis of containers. An Image is an 
						ordered collection of root filesystem changes and the corresponding 
						execution parameters for use within a container runtime. All containers 
						start from a base image and layers are added by making changes to the filesystem.
					</p>
				</section>
				<section>
					<h4>Dockerfile</h4>
					<p class="ta-left">A Dockerfile is a text document that contains all the 
						commands you would normally execute manually in order to build a 
						Docker image. Docker can build images automatically by reading the 
						instructions from a Dockerfile.
					</p>
				</section>
				<section>
					<h4>Recap</h4>
					<div class="stretch">
						<img src="assets/recap.png" alt="Docker flow recap">
					</div>
					
				</section>
				<section>
					<h4>Cross-build Docker File</h4>
						<pre class="stretch"><code># Mock ENV for cross build MT7688
#
# Pull base image.
FROM ubuntu:14.04
# Install.
RUN \
  sed -i 's/# \(.*multiverse$\)/\1/g' /etc/apt/sources.list && \
  apt-get update && \
  apt-get -y upgrade && \
  apt-get install -y build-essential && \
  apt-get install -y python && \
  apt-get install -y software-properties-common && \
  apt-get install -y byobu curl git htop man unzip vim wget && \
  rm -rf /var/lib/apt/lists/*
# Set environment variables.
ENV HOME /root
# Define working directory.
WORKDIR /root
# Install NVM
RUN curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.1/install.sh | bash
ENV \
  NVM_DIR=/root/.nvm \
  NODE_VERSION=v0.12.7
# Install Node v0.12.7 and NPM v2.11.3
RUN \ 
  . $HOME/.nvm/nvm.sh && \
  nvm install $NODE_VERSION && \
  nvm alias default $NODE_VERSION && \
  nvm use default && \
  npm install -g npm@2.11.3
# Clone MT7688 cross-build repo and build enviornment.
RUN \
  git clone https://github.com/simenkid/mt7688-cross.git && \
  cd mt7688-cross && \
  bash create_env.sh
# Define default command.
CMD ["bash"]
							</code></pre>
				</section>
				<section>
					<h4>Lets build it!</h4>
					<p class="ta-left">To build our custom image from our Dockerfile we run:</p>
					<pre><code>docker build -t mt7688-cross .</code></pre>
					<p class="ta-left">This tells docker to look in the local directory for our 
						Dockerfile, build the image and tag it <i>mt7688-cross</i>.
					</p>
				</section>
				<section>
					<h4>Build Image from Dockerfile</h4>
					<video controls>
						<source src="assets/building_docker_file.mp4" type="video/mp4">
					</video>
				</section>
				<section>
					<div class="cross_build_success">
						<img src="assets/cross_build_done.png" alt="Cross build success message">
					</div>
					<div>
						<img src="assets/custom_image_size.png" alt="Size of custom docker images">
					</div>
				</section>
				<section>
					<h4>Run image in container</h4>
					<pre><code>docker run -it mt7688-cross </code></pre>
					<div class="stretch">
						<img src="assets/docker_run_image.png" alt="Docker run image">
					</div>
				</section>
				<section>
					<h4>Exit running container</h4>
					<pre><code>exit</code></pre>
					<div class="stretch">
						<img src="assets/docker_exit.png" alt="Exit running container">
					</div>
				</section>
				<section>
					<h4>Start container and attach</h4>
					<pre><code>docker start -ai container_id</code></pre>
					<p class="ta-left">This starts the container and then attaches to the container 
						using the flags <i>-a</i> for attach and <i>-i</i> for interactive.
					</p>
					<div class="stretch">
						<img src="assets/docker_start.png" alt="Start stoped container">
					</div>
				</section>
				<section>
					<h3>Ready to install npm modules.</h3>
					<p class="ta-left">To install modules, we run the following command from inside
						the cross-build folder.
					</p>
					<pre><code>./npm_install.sh NAME_OF_MODULE</code></pre>
					<p class="ta-left">Install express.</p>
					<pre><code>./npm_install.sh express</code></pre>
					<p class="ta-left">You can also specifiy module versions</p>
					<pre><code>./npm_install.sh serialport@2.1.2</code></pre>
				</section>
				<section>
					<h4>Compiling johnny-five</h4>
					<video controls>
						<source src="assets/building_node_module.mp4" type="video/mp4">
					</video>
				</section>

			</section>
			<section>Demo or it didn't happen...</section>
			<section>
				<h4>Sources</h4>
				<ul class="sources_list">
					<li>
						Blue Chen. "LinkIt smart 7688 e-book for Node.js community", 
						https://iamblue.gitbooks.io/linkit-smart-nodejs/en/, MediaTek, 
						18 Dec. 2016. Web. 22 Apr. 2017.
					</li>
					<li>
						"What is Docker?", https://www.docker.com/what-docker, Docker, 2017.
						Web. 22 Apr. 2017.
					</li>
					<li>
						"What is a Container?", https://www.docker.com/what-container, Docker, 2017.
						Web. 22 Apr. 2017.
					</li>
					<li>
						Jake Wright. "Learn Docker in 12 Minutes", 
						https://www.youtube.com/watch?v=YFl2mCHdv24, YouTube, 6 Sept. 2016.
						Web. 22 Apr. 2017. 
					</li>
				</ul>
			</section>
		</div>
	</div>

	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.js"></script>

	<script>
		// More info https://github.com/hakimel/reveal.js#configuration
		Reveal.initialize({
			history: true,

			// More info https://github.com/hakimel/reveal.js#dependencies
			dependencies: [
				{ src: 'plugin/markdown/marked.js' },
				{ src: 'plugin/markdown/markdown.js' },
				{ src: 'plugin/notes/notes.js', async: true },
				{ src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } }
			]
		});
	</script>
</body>

</html>